@model ProductModel
@{
    ViewData["Title"] = "ProductDetails";
    Layout = "~/Views/Shared/SellerCompanyLayout.cshtml";
}

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f2f2f2;
        color: black
    }

    .urun-detail {
        background-color: #ffffff;
        padding: 20px;
        border: 1px solid #cccccc;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        max-width: 600px;
        margin: 20px auto;
        text-align: center;
    }

        .urun-detail img {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .urun-detail h1 {
            font-size: 24px;
            color: #333333;
            margin-bottom: 10px;
        }

        .urun-detail p {
            margin: 5px 0;
        }

        .urun-detail .button-container {
            margin-top: 20px;
        }

        .urun-detail .btn {
            padding: 10px 20px;
            background-color: #007bff;
            color: #ffffff;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

            .urun-detail .btn:hover {
                background-color: #0056b3;
            }

    .pop-up {
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        /* background-color: rgba(0,0,0,0.4); */
        display: none;
    }

    .popUp-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        color: black;
        width: 80%;
        max-width: 600px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: modalopen 0.5s;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .close-reporter {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close-reporter:hover,
        .close-reporter:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }




    @@keyframes modalopen {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .accordion {
        padding: 15px;
        background-color: #eeeeee;
        border: 1px solid #cccccc;
        border-radius: 5px;
        margin-bottom: 10px;
        transition: background-color 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

        .accordion:hover {
            background-color: #dddddd;
        }

        .accordion h1 {
            font-size: 18px;
            margin: 0;
            color: #333333;
        }

        .accordion p {
            margin: 5px 0;
            color: #555555;
            font-size: 14px;
        }

        .accordion .view-replies {
            display: inline-block;
            margin-top: 10px;
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
        }

            .accordion .view-replies:hover {
                text-decoration: underline;
            }



    .panel {
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #dddddd;
        border-radius: 5px;
        margin-top: 10px;
        display: none;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /*  .replies {
                                                background-color: #f9f9f9;
                                                padding: 20px;
                                                border-radius: 5px;
                                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                                                margin-top: 20px;
                                                max-width: 600px;
                                                margin: 20px auto;
                                            }

                                            .reply {
                                                background-color: #ffffff;
                                                padding: 15px;
                                                border: 1px solid #ddd;
                                                border-radius: 5px;
                                                margin-bottom: 15px;
                                                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                                            }

                                                .reply p {
                                                    margin: 0;
                                                    font-size: 14px;
                                                }

                                                .reply strong {
                                                    color: #007bff;
                                                }

                                            .reply-date {
                                                font-size: 12px;
                                                color: #888;
                                                margin-top: 5px;
                                            } */

    .replies {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        max-width: 600px;
        margin: 0 auto;
    }

    .reply {
        background-color: #ffffff;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

        .reply p {
            margin: 0;
            font-size: 14px;
        }

        .reply strong {
            color: #007bff;
        }

    .reply-date {
        font-size: 12px;
        color: #888;
        margin-top: 5px;
    }

    .action-buttons {
        margin-top: 10px;
    }

        .action-buttons button {
            background-color: #007bff;
            color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 5px;
        }

            .action-buttons button:hover {
                background-color: #0056b3;
            }

            .action-buttons button.report-reply-button {
                background-color: #dc3545;
            }

                .action-buttons button.report-reply-button:hover {
                    background-color: #c82333;
                }

    .comments-section {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
    }

        .comments-section h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

    .comment {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

        .comment h2 {
            font-size: 20px;
            color: #007bff;
            margin-top: 0;
        }

    .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .comment-user {
        font-weight: bold;
        color: #333;
    }

    .comment-date {
        font-size: 12px;
        color: #888;
    }

    .comment-text {
        font-size: 14px;
        color: #333;
        margin-bottom: 10px;
    }

    .view-replies {
        display: inline-block;
        font-size: 14px;
        color: #007bff;
        text-decoration: none;
        margin-bottom: 10px;
    }

        .view-replies:hover {
            text-decoration: underline;
        }

    .panel {
        display: none; /* Initially hide replies */
        padding-top: 10px;
    }

    .action-buttons {
        margin-top: 10px;
    }

        .action-buttons a {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 4px;
            color: #fff;
            text-decoration: none;
            margin-right: 5px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

    .reply-button {
        background-color: #007bff;
    }

        .reply-button:hover {
            background-color: #0056b3;
        }

    .report-button {
        background-color: #dc3545;
    }

        .report-button:hover {
            background-color: #c82333;
        }

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function () {


        var popup = $("#updater");
        var close = $(".close");
        $("#open-updater").click(function (e) {
            e.preventDefault();
            popup.show();
        });
        close.click(function () {
            popup.hide();
        });
        $(window).click(function (event) {
            if (event.target == popup[0]) {
                popup.hide();
            }
        });




        $("#update-account").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr("action");
            var data = form.serialize();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Başarılı",
                            text: "Ürün başarıyla güncellendi",
                            confirmButtonText: "Tamam"
                        }).then(function () {
                            popup.hide();
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: "error",
                            title: "Hata",
                            text: response.message || "Bir hata oluştu",
                            confirmButtonText: "Tamam"
                        });

                    }
                },
                error: function () {
                    Swal.fire({
                        icon: "error",
                        title: "Hata",
                        text: "Bir hata oluştu",
                        confirmButtonText: "Tamam"
                    });
                }

            });
        });


        $("#delete").click(function (e) {
            e.preventDefault();
            var url = $(this).attr("href");
            Swal.fire({
                icon: "warning",
                title: "Ürünü silmek istedğinizden emin misiniz?",
                text: "Bu işlemi geri alamazsınız",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Evet',
                cancelButtonText: "Vazgeç"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: url,
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Silindi',
                                    'Ürün Başarıyla Silindi',
                                    'success'
                                ).then(function () {
                                    window.location.href = "/Product/Products";
                                });
                            }
                            else {
                                Swal.fire(
                                    'Hata',
                                    response.message || "Ürün silinirken bir hata oluştu",
                                    'error'
                                );
                            }
                        },
                        error: function () {
                            Swal.fire(
                                "Hata",
                                "Ürün Silinemedi",
                                "error"
                            );
                        }
                    });
                }
            })
        });
        $(".view-replies").click(function (e) {
            e.preventDefault();
            var data = $(this).data("comment-id");
            var panel = $(this).next(".panel");
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetReplies", "Product")",
                data: { commentId: data },
                success: function (data) {
                    panel.html(data);
                    panel.slideToggle();
                },
                error: function (xhr, status, error) {
                    console.error("Hata: " + xhr.responseText);
                }
            });
        });
        var commentReporter = $("#comment-reporter");
        var commentReportCloser = $(".close-comment-reporter");
        var commentId;
        var userId;
        $("#report-comment-button").click(function (e) {
            e.preventDefault();
            commentId = $(this).data("comment-id");
            userId = $(this).data("user-id");
            commentReporter.show();
        });
        commentReportCloser.click(function () {
            commentReporter.hide();
        });
        $(window).click(function (event) {
            if (event.target == commentReporter[0]) {
                commentReporter.hide();
            }
        });
        $("#report-comment").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr("action");
            var data = form.serializeArray();
            data.push({ name: "YorumId", value: commentId });
            data.push({ name: "KullaniciId", value: userId });
            $.ajax({
                type: "POST",
                url: url,
                data: $.param(data),
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Başarılı",
                            text: "Şikayetiniz alınmıştır",
                            confirmButtonText: "Tamam"
                        }).then(function () {
                            commentReporter.hide();
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: "error",
                            title: "Hata",
                            text: response.message || "Bir hata oluştu",
                            confirmButtonText: "Tamam"
                        })
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: "error",
                        title: "Hata",
                        text: "Bir hata oluştu",
                        confirmButtonText: "Tamam"
                    });
                }
            });
        });

        var replyReporter = $("#reply-reporter");
        var replyReportCloser = $(".close-reply-reporter");
        var replyId;
        $(document).on("click", ".report-reply-button", function (e) {
            e.preventDefault();
            replyId = $(this).data("reply-id");
            userId = $(this).data("user-id");
            replyReporter.show();
        })
        // $("#report-reply-button").click(function (e) {
        //     e.preventDefault();
        //     commentId = $(this).data("comment-id");
        //     userId = $(this).data("user-id");
        //     replyReporter.show();
        // });
        replyReportCloser.click(function () {
            replyReporter.hide();
        });
        $(window).click(function (event) {
            if (event.target == replyReporter[0]) {
                replyReporter.hide();
            }
        });
        $("#report-reply").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr("action");
            var data = form.serializeArray();
            data.push({ name: "YorumCevapId", value: replyId });
            data.push({ name: "KullaniciId", value: userId })
            $.ajax({
                type: "POST",
                url: url,
                data: $.param(data),
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Başarılı",
                            text: "Şikayetiniz Alınmıştır",
                            confirmButtonText: "Tamam"
                        }).then(function () {
                            replyReporter.hide();
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: "error",
                            title: "Hata",
                            text: response.message || "Bir hata oluştu",
                            confirmButtonText: "Tamam"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error Details:", status, error);
                    console.log("Response text", xhr.responseText);
                    Swal.fire({
                        icon: "error",
                        title: "Hata",
                        text: "Bir hata oluştu",
                        confirmButtonText: "Tamam"
                    });
                }
            });
        });
        var replyAdder = $("#add-reply");
        var replyAddingCloser = $(".close-reply-adder");
        $("#add-reply-button").click(function (e) {
            e.preventDefault();
            commentId = $(this).data("comment-id");
            replyAdder.show();
        });
        replyAddingCloser.click(function () {
            replyAdder.hide();
        });
        $(window).click(function (event) {
            if (event.target == replyAdder[0]) {
                replyAdder.hide();
            }
        });


        $("#add-reply-form").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = $(this).attr("action");
            var data = form.serializeArray();
            data.push({ name: "YorumId", value: commentId });
            $.ajax({
                type: "POST",
                url: url,
                data: $.param(data),
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Başarılı",
                            text: "Cevap başarıyla eklendi",
                            confirmButtonText: "Tamam"

                        }).then(function () {
                            replyAdder.hide();
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: "error",
                            title: "Hata",
                            text: response.message || "Bir hata oluştu",
                            confirmButtonText: "Tamam"
                        });
                    }
                },
                error: function (response) {
                    Swal.fire({
                        icon: "error",
                        title: "Hata",
                        text: "Bir hata oluştu",
                        confirmButtonText: "Tamam"
                    });
                }
            });
        });
        var replyForReplyPopUp = $("#reply-to-reply");
        var replyReplyCloser = $(".close-reply-replyer");

        var userName;
        $(document).on("click", ".reply-replyer-button", function (e) {
            e.preventDefault();
            commentId = $(this).data("comment-id");
            userName = $(this).data("user-name");
            replyForReplyPopUp.show();
        });
        replyReplyCloser.click(function () {
            replyForReplyPopUp.hide();
        });
        $(window).click(function (event) {
            if (event.target == replyForReplyPopUp[0]) {
                replyForReplyPopUp.hide();
            }
        });
        $("#reply-for-reply").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr("action");
            data = form.serializeArray();
            data.push({ name: "YorumId", value: commentId });
            data.push({ name: "recevierName", value: userName });
            $.ajax({
                type: "POST",
                url: url,
                data: $.param(data),
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Başarılı",
                            text: "Cevap başarıyla eklendi",
                            confirmButtonText: "Tamam"
                        }).then(function () {
                            replyForReplyPopUp.hide();
                            location.reload();
                        });
                    } else {
                        Swal.fire({
                            icon: "error",
                            title: "Hata",
                            text: response.message || "Bir hata oluştu",
                            confirmButtonText: "Tamam"
                        })
                    }
                },
                error: function (response) {
                    Swal.fire({
                        icon: "error",
                        title: "Hata",
                        text: "Bir hata oluştu",
                        confirmButtonText: "Tamam"
                    });
                }
            });
        });
    });
</script>


<div class="urun-detail">
    <img src="@Url.Content("~/images/" + Model.ProductImage)" alt="@Model.ProductName" />

    <h1>@Model.ProductName</h1>
    <p><strong>Kategori:</strong> @Model.CategoryName</p>
    <p><strong>Açıklama:</strong> @Model.Description</p>
    <p><strong>Firma:</strong> @Model.CategoryName</p>
    <p><strong>Fiyat:</strong> @Model.Price</p>
    <p><strong>Stok:</strong> @Model.Stock</p>
    <p><strong>Eklenme Tarihi:</strong> @Model.AddedDate</p>
    <p><strong>Satış Sayısı:</strong>@Model.SalesCount</p>
    <p><strong>Sepete Eklenme Sayısı:</strong>@Model.timesAddedToCart</p>
    <p><strong>Stok:</strong>@Model.Stock</p>
    <div class="button-container">
        <a href="#" id="open-updater" class="btn">Güncelle</a>
        <a href="@Url.Action("DeleteProduct","Product",new {productId=Model.ProductId})" id="delete" class="btn">Sil</a>
    </div>
</div>
<div class="comments-section">
    <h1>Yorumlar</h1>

    @foreach (var comment in Model.comments)
    {
        <div class="comment">
            <h2>Yorum</h2>
            <div class="comment-header">
                <p class="comment-user">@comment.UserName</p>

                <p class="comment-date">@comment.Date</p>


            </div>
            <p class="comment-text">@comment.Comment</p>

            <a href="#" class="view-replies" data-comment-id="@comment.CommentId">Cevapları görüntüle</a>

            <div class="panel">
                <!-- Replies will be loaded here -->
            </div>

            <div class="action-buttons">
                <a href="#" id="add-reply-button" class="reply-button" data-comment-id="@comment.CommentId">Cevap Ver</a>
                <a href="#" id="report-comment-button" class="report-button" data-comment-id="@comment.CommentId" data-user-id="@comment.UserId">Şikayet Et</a>

            </div>
        </div>
    }
</div>





<div id="updater" class="pop-up" style="display:none">
    <div class="popUp-content">
        <span class="close">&times;</span>
        <h2>Ürün Güncelle</h2>
        <form id="update-account" action="@Url.Action("UpdateProduct","Product")" method="post">
            <input type="hidden" name="UrunId" value="@Model.ProductId" />
            <label>Ürün Ad:</label>
            <input type="text" name="UrunAd" value="@Model.ProductName" />
            <br />
            <label>Açıklama:</label>
            <input type="text" name="Aciklama" value="@Model.Description" />
            <br />
            <label>Fiyat:</label>
            <input type="text" name="Fiyat" value="@Model.Price" />
            <br />
            <label>Stok:</label>
            <input type="text" name="Stok" value="@Model.Stock" />
            <br />
            <label>Resim:</label>
            <input type="file" name="UrunResim" value="@Model.ProductImage" />
            <br />
            <button type="submit">Güncelle</button>
        </form>
    </div>
</div>


<div id="comment-reporter" class="pop-up" style="display:none">
    <div class="popUp-content">
        <span class="close-comment-reporter">&times;</span>
        <h2>Şikayet Et</h2>
        <form id="report-comment" action="@Url.Action("ReportUserComment","Report")" method="post">
            <label>Şikayet Başlık:</label>
            <input type="text" name="SikayetBaslik" />
            <br />
            <label>Şikayet Metni:</label>
            <textarea name="SikayetMetni"></textarea>
            <br />
            <button type="submit">Şikayeti Gönder</button>
        </form>
    </div>
</div>


<div id="reply-reporter" class="pop-up" style="display:none">
    <div class="popUp-content">
        <span class="close-reply-reporter">&times;</span>
        <h2>Cevabı Şikayet Et</h2>
        <form id="report-reply" action="@Url.Action("ReportUserReply","Report")" method="post">
            <label>Şikayet Başlık</label>
            <input type="text" name="SikayetBaslik" required />
            <br />
            <label>Şikayet:</label>
            <textarea name="SikayetMetni" required></textarea>
            <br />
            <button type="submit">Şikayet Et</button>
        </form>
    </div>
</div>


<div id="add-reply" class="pop-up" style="display:none">
    <div class="popUp-content">
        <span class="close-reply-adder">&times;</span>
        <h2>Cevap Ver</h2>
        <form id="add-reply-form" action="@Url.Action("AddReply","Product")" method="post">
            <label>Cevap:</label>
            <input type="text" name="Cevap" />
            <button type="submit">Cevap Ver</button>
        </form>
    </div>
</div>


<div id="reply-to-reply" class="pop-up" style="display:none">
    <div class="popUp-content">
        <span class="close-reply-replyer"></span>
        <h2>Cevap Ver</h2>
        <form id="reply-for-reply" action="@Url.Action("AddReplyForReply","Product")" method="post">
            <label>Cevap:</label>
            <input type="text" name="Cevap" required />
            <button type="submit">Cevap Ver</button>
        </form>
    </div>
</div>